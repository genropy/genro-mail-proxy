# Dovecot configuration for bounce detection testing
# Minimal setup with plaintext auth for testing only (Dovecot 2.3.x)

# Protocols
protocols = imap

# Logging
log_path = /var/log/dovecot.log
auth_verbose = yes
auth_debug = yes
mail_debug = yes

# Disable SSL for testing (use port 143)
ssl = no

# Allow plaintext auth (testing only!)
disable_plaintext_auth = no
auth_mechanisms = plain login

# User database - static users
passdb {
  driver = passwd-file
  args = /etc/dovecot/users
}

userdb {
  driver = passwd-file
  args = /etc/dovecot/users
}

# Mail location - use Maildir format
mail_location = maildir:/var/mail/%u

# Create mailbox automatically
namespace inbox {
  inbox = yes
  location =
  mailbox Drafts {
    special_use = \Drafts
  }
  mailbox Junk {
    special_use = \Junk
  }
  mailbox Sent {
    special_use = \Sent
  }
  mailbox Trash {
    special_use = \Trash
  }
}

# LDA for local delivery (used to inject bounce emails)
protocol lda {
  mail_plugins =
  postmaster_address = postmaster@localhost
}

# LMTP for programmatic delivery
service lmtp {
  inet_listener lmtp {
    address = 0.0.0.0
    port = 24
  }
}

# Allow connections from test network
service imap-login {
  inet_listener imap {
    address = 0.0.0.0
    port = 143
  }
}

# First valid UID/GID (allow any)
first_valid_uid = 1
first_valid_gid = 1
